version: 2

models:
  - name: fct_votacao
    description: "One row per senator × voting session — joins nominal votes with session metadata and senator dimension"
    columns:
      - name: codigo_sessao_votacao
        description: "Voting session ID (composite PK with codigo_parlamentar)"
        data_tests:
          - not_null

      - name: codigo_parlamentar
        description: "Senator code as integer (composite PK with codigo_sessao_votacao)"
        data_tests:
          - not_null

      - name: senador_id
        description: "Senator code as VARCHAR (FK → dim_senador)"

      - name: data_sessao
        description: "Date the plenary session took place"
        data_tests:
          - not_null

      - name: sigla_voto
        description: "Vote cast: Sim, Não, Abstenção, AP (absent/paired), LS (licensed), MIS (missing), P-NRV (present no vote)"

      - name: voto_afirmativo
        description: "True when the senator voted Sim"

      - name: voto_negativo
        description: "True when the senator voted Não"

      - name: ausente
        description: "True when senator was absent from the session (AP, LS, MIS codes)"

      - name: partido_sigla_voto
        description: "Party abbreviation at time of vote (historical — may differ from current dim_senador.partido_sigla)"

  - name: fct_ceaps
    description: "One row per CEAPS expense reimbursement receipt — ADM API from 2019"
    columns:
      - name: id
        description: "Unique expense receipt ID from ADM API (PK)"
        data_tests:
          - not_null
          - unique

      - name: senador_id
        description: "Senator code as VARCHAR — cast from ADM integer cod_senador (FK → dim_senador)"
        data_tests:
          - not_null

      - name: ano
        description: "Expense year"
        data_tests:
          - not_null

      - name: mes
        description: "Expense month (1-12)"
        data_tests:
          - not_null

      - name: tipo_despesa
        description: "Expense category (e.g. consultancy, travel, office supplies)"

      - name: fornecedor
        description: "Vendor name"

      - name: valor_reembolsado
        description: "Reimbursement amount in BRL"
        data_tests:
          - not_null

  - name: fct_auxilio_moradia
    description: "One row per senator — current snapshot of housing allowance and official apartment usage (ADM API)"
    columns:
      - name: nome_parlamentar
        description: "Senator name uppercased (PK — no senator ID in ADM housing API)"
        data_tests:
          - not_null
          - unique

      - name: auxilio_moradia
        description: "True when senator receives monthly housing allowance payment"
        data_tests:
          - not_null

      - name: imovel_funcional
        description: "True when senator uses an official Senate-owned apartment"
        data_tests:
          - not_null

  - name: fct_remuneracao_servidor
    description: "One row per staff member × month × payroll type — ADM API /api/v1/servidores/remuneracoes/{ano}/{mes} from 2019. Incremental merge on data_competencia."
    columns:
      - name: sequencial
        description: "Staff member ID (composite PK with ano, mes, tipo_folha — FK → dim_servidor)"
        data_tests:
          - not_null

      - name: ano
        description: "Payroll year"
        data_tests:
          - not_null

      - name: mes
        description: "Payroll month (1–12)"
        data_tests:
          - not_null

      - name: tipo_folha
        description: "Payroll type: regular, supplementary (13th salary), etc."

      - name: data_competencia
        description: "First-of-month DATE constructed from (ano, mes) — used as incremental watermark"
        data_tests:
          - not_null

      - name: remuneracao_liquida
        description: "Net take-home pay in BRL after all deductions"

      - name: remuneracao_bruta
        description: "Computed gross pay: sum of all positive pay components"

  - name: fct_remuneracao_pensionista
    description: "One row per pensioner × month — ADM API /api/v1/servidores/pensionistas/remuneracoes/{ano}/{mes} from 2019. Incremental merge on data_competencia."
    columns:
      - name: sequencial
        description: "Pensioner ID (composite PK with ano, mes — FK → dim_pensionista)"
        data_tests:
          - not_null

      - name: ano
        description: "Payroll year"
        data_tests:
          - not_null

      - name: mes
        description: "Payroll month (1–12)"
        data_tests:
          - not_null

      - name: remuneracao_liquida
        description: "Net monthly pension payment in BRL"

      - name: remuneracao_bruta
        description: "Computed gross pension: sum of all positive components"

  - name: fct_hora_extra
    description: "One row per staff member × payment month — monthly overtime summary from /api/v1/servidores/horas-extras/{ano}/{mes} from 2019. Full refresh (small table)."
    columns:
      - name: sequencial
        description: "Staff member ID (composite PK with ano_pagamento, mes_pagamento — FK → dim_servidor)"
        data_tests:
          - not_null

      - name: ano_pagamento
        description: "Year when overtime was paid"
        data_tests:
          - not_null

      - name: mes_pagamento
        description: "Month when overtime was paid (1–12)"
        data_tests:
          - not_null

      - name: valor_total
        description: "Total overtime payment amount in BRL for this staff member in this month"

      - name: lotacao_sigla
        description: "Organizational unit of the staff member (from dim_servidor)"

  - name: fct_emenda_documento
    description: "One row per amendment × SIAFI expense document × expense phase. Source: Portal da Transparência emendas-parlamentares-documentos (2014–current). Incremental merge by ano_emenda."
    columns:
      - name: codigo_emenda
        description: "Amendment identifier (composite PK with codigo_documento, fase_despesa — FK → dim_emenda)"
        data_tests:
          - not_null

      - name: codigo_documento
        description: "SIAFI document identifier (composite PK with codigo_emenda, fase_despesa)"
        data_tests:
          - not_null

      - name: fase_despesa
        description: "Expense phase: Empenho (commitment), Liquidação (accrual), or Pagamento (payment)"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['Empenho', 'Liquidação', 'Pagamento']

      - name: ano_emenda
        description: "Amendment year — used as incremental watermark"
        data_tests:
          - not_null

      - name: senador_id
        description: "Senator code (FK → dim_senador) — NULL for non-individual or non-senator amendments"

      - name: valor_pago
        description: "Amount paid in BRL (valid for Pagamento phase only)"

      - name: valor_empenhado
        description: "Amount committed in BRL (valid for Empenho phase only)"

  - name: fct_apoiamento_emenda
    description: "One row per SIAFI commitment × supporting legislator (apoiador). Source: Portal da Transparência apoiamento-emendas-parlamentares (2020–2025)."
    columns:
      - name: empenho
        description: "SIAFI commitment identifier (composite PK with codigo_apoiador)"
        data_tests:
          - not_null

      - name: codigo_apoiador
        description: "SIAFI code of the supporting legislator (composite PK with empenho)"
        data_tests:
          - not_null

      - name: ano_emenda
        description: "Amendment year"
        data_tests:
          - not_null

      - name: senador_id_apoiador
        description: "Senator code of the supporter (FK → dim_senador) — NULL if not a current senator"

      - name: valor_empenhado
        description: "Total commitment amount in BRL (excludes cancellations)"

      - name: valor_pago
        description: "Total paid amount in BRL"
