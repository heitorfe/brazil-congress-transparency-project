version: 2

models:
  - name: agg_senador_despesas
    description: "Pre-aggregated CEAPS expense totals per senator × year × month × category — used directly by Streamlit dashboard to avoid scanning 100k+ raw rows at render time"
    columns:
      - name: senador_id
        description: "Senator code (FK → dim_senador)"
        data_tests:
          - not_null

      - name: ano
        description: "Expense year"
        data_tests:
          - not_null

      - name: tipo_despesa
        description: "Expense category"

      - name: qtd_recibos
        description: "Number of receipts in this group"

      - name: total_reembolsado
        description: "Total reimbursed amount in BRL for this aggregation group"

  - name: agg_comissao_membros
    description: "Pre-aggregated current committee membership counts — used for dashboard cards and committee filters"
    columns:
      - name: codigo_comissao
        description: "Committee code (PK in this aggregation)"
        data_tests:
          - not_null
          - unique

      - name: num_membros_atuais
        description: "Total current members (Titular + Suplente)"

      - name: num_titulares
        description: "Current Titular members count"

      - name: num_suplentes
        description: "Current Suplente members count"

  - name: agg_emenda_por_autor
    description: "Pre-aggregated parliamentary amendment payments per (author × year × tipo_emenda). Grain: 1 row per (nome_autor_emenda × ano_emenda × tipo_emenda). Only 'Pagamento' phase to avoid triple-counting."
    columns:
      - name: nome_autor_emenda
        description: "Author name as registered in SIAFI (uppercase, no accents)"
        data_tests:
          - not_null

      - name: ano_emenda
        description: "Amendment year"
        data_tests:
          - not_null

      - name: tipo_emenda
        description: "Amendment type (Emenda Individual, Bancada, Comissão, Relator)"
        data_tests:
          - not_null

      - name: senador_id
        description: "Senator code (FK → dim_senador) — NULL for non-senators or former legislators"

      - name: total_pago
        description: "Sum of valor_pago across all payment documents for this author × year × type"

      - name: num_emendas
        description: "Distinct amendment codes in this group"

      - name: num_favorecidos_distintos
        description: "Distinct beneficiaries (CNPJ/CPF) across all documents"

      - name: num_municipios_distintos
        description: "Distinct municipalities where resources were applied"

  - name: agg_pessoal_mensal
    description: "Pre-aggregated staff payroll totals per (ano × mes × vinculo × lotacao_sigla) — used by Streamlit to avoid scanning 840k+ raw rows at render time"
    columns:
      - name: ano
        description: "Payroll year"
        data_tests:
          - not_null

      - name: mes
        description: "Payroll month (1–12)"
        data_tests:
          - not_null

      - name: vinculo
        description: "Employment bond type (EFETIVO, COMISSIONADO, etc.) — NULL replaced with 'NÃO INFORMADO'"
        data_tests:
          - not_null

      - name: lotacao_sigla
        description: "Organizational unit abbreviation — NULL replaced with 'NÃO INFORMADO'"
        data_tests:
          - not_null

      - name: num_servidores
        description: "Distinct staff members in this group"

      - name: total_liquido
        description: "Sum of net pay (remuneracao_liquida) for this group"

      - name: total_bruto
        description: "Sum of gross pay (remuneracao_bruta) for this group"

      - name: total_horas_extras_valor
        description: "Sum of overtime component embedded in the payroll (not from fct_hora_extra)"
